USE MOVIETEST;

CREATE TABLE ACTOR (
ACT_ID INT  PRIMARY KEY,
ACT_NAME VARCHAR(50),
ACT_GENDER VARCHAR(1)

);


CREATE TABLE DIRECTOR(
DIR_ID INT PRIMARY KEY,
DIR_NAME VARCHAR(20),
DIR_PHONENO VARCHAR(20)
);

CREATE TABLE MOVIES(
MOV_ID INT  PRIMARY KEY,
MOV_TITLE VARCHAR(50) ,
MOV_YEAR INT ,

MOV_LANG VARCHAR(50),
DIR_ID INT, FOREIGN KEY (DIR_ID) REFERENCES DIRECTOR (DIR_ID)
);

CREATE TABLE MOVIE_CAST(
ACT_ID INT REFERENCES ACTOR(ACT_ID),
MOV_ID INT,
ROLEM VARCHAR(50),
FOREIGN KEY (MOV_ID) REFERENCES MOVIES(MOV_ID)
);

CREATE TABLE RATING (
MOV_ID INT,
REV_STAR INT,
FOREIGN KEY(MOV_ID) REFERENCES MOVIES (MOV_ID)
);


INSERT INTO ACTOR(ACT_ID,ACT_NAME,ACT_GENDER)
VALUES
(301,'ANUSHKA','F'),
(302,'PRABHAS','M'),
(303,'PUNITH','M'),
(304,'JERMY','M');


INSERT INTO DIRECTOR (DIR_ID,DIR_NAME,DIR_PHONENO)
VALUES
(60,'RAJAMOULI','8751611001'),
(61,'HITCHCOCK','7766138911'),
(62,'FARAN', '9986776531'),
(63,'STEVEN SPIELBERG', '8989776530');


INSERT INTO MOVIES( MOV_ID,MOV_TITLE,MOV_YEAR,MOV_LANG,DIR_ID)
VALUES
(1001,'BAHUBALI-2',2017,'TELAGU',60),
(1002,'BAHUBALI-1',2015,'TELAGU',60),
(1003,'AKASH' , '2008','KANNADA',61),
(1004,'WAR HORSE',2011, 'ENGLISH', 63);

INSERT INTO  MOVIE_CAST (ACT_ID,MOV_ID,ROLEM)
VALUES 
(301,1002,'HEROINE'),
(301,1001,'HEROINE'),
(303,1003,'HERO'),
(303,1002,'GUEST'),
(304,1004,'HERO');

INSERT INTO RATING(MOV_ID,REV_STAR)
VALUES 
(1001,4),
(1002,2),
(1003,5),
(1004,4);




-- PART A ASSESSMENT

-- 1. LIST THE TITLES OF ALL MOVIES DIRECTED BY 'HITCHCOCK'

SELECT MOV_TITLE FROM MOVIES
WHERE DIR_ID IN (SELECT DIR_ID FROM DIRECTOR);

-- 2. FIND THE MOVIE NAMES WHERE ONE OR MORE ACTORS ACTED IN TWO OR MORE MOVIES

SELECT MOV_TITLE FROM MOVIES ,MOVIE_CAST WHERE MOVIES.MOV_ID = MOVIE_CAST.MOV_ID AND ACT_ID IN 
(SELECT ACT_ID FROM MOVIE_CAST GROUP BY ACT_ID HAVING  COUNT(ACT_ID)>1)

GROUP BY MOV_TITLE HAVING COUNT(MOV_TITLE)>1;

-- 3. LIST ALL ACTORS WHO ACTED IN A MOVIE BEFORE 2000 AND ALSO IN A MOVIE AFTER 2015 (USE JOIN OPERATION)

SELECT ACT_NAME FROM 
ACTOR 
JOIN MOVIE_CAST ON MOVIE_CAST.ACT_ID =  ACTOR.ACT_ID
JOIN MOVIES ON MOVIES.MOV_ID = MOVIE_CAST.MOV_ID
WHERE MOV_YEAR<2000 OR MOV_YEAR>2015;


-- 4. FIND THE TITLE OF MOVIES AND NUMBER OF STARS FOR EACH MOVIE THAT HAS AT LEAST ONE RATING AND FIND THE HIGHEST NUMBER OF STARS THAT MOVIE RECIVED. SORT THE RESULT BY MOVIE TITLE
 SELECT MOV_TITLE, MAX(REV_STAR) FROM MOVIES M INNER JOIN RATING R ON
 M.MOV_ID = R.MOV_ID GROUP BY
 MOV_TITLE ORDER BY MOV_TITLE;


-- 5. UPDATE RATING OF ALL MOVIES DIRECTED BY 'STEVEN SPIELBERG' TO 5

UPDATE RATING
JOIN MOVIES
ON MOVIES.MOV_ID = RATING.MOV_ID
JOIN DIRECTOR
ON DIRECTOR.DIR_ID = MOVIES.MOV_ID
SET REV_STAR = 5
WHERE DIR_NAME = "STEVEN SPIELBERG";

